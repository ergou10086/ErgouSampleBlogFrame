# ErgouSampleBlogFrame

ä¸€ä¸ªæä¸ºç®€æ´çš„åšå®¢ç³»ç»Ÿæ¡†æ¶ï¼Œä½¿ç”¨ Node.js + Express + EJS + Supabase æ„å»ºï¼Œæ”¯æŒ Markdown æ ¼å¼æ–‡ç« ç¼–å†™ï¼Œé€‚åˆå­¦ä¹ JS,EJSå’Œå°å‹é¡¹ç›®å†…åµŒä½¿ç”¨ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- âœ… **ç”¨æˆ·è®¤è¯ç³»ç»Ÿ** - åŸºäº Supabase Auth çš„ç”¨æˆ·æ³¨å†Œã€ç™»å½•åŠŸèƒ½
- âœ… **æ–‡ç« ç®¡ç†** - åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤åšå®¢æ–‡ç« 
- âœ… **Markdown æ”¯æŒ** - ä½¿ç”¨ Markdown æ ¼å¼ç¼–å†™æ–‡ç« ï¼Œè‡ªåŠ¨æ¸²æŸ“ä¸º HTML
- âœ… **åˆ†é¡µå±•ç¤º** - é¦–é¡µæ–‡ç« åˆ—è¡¨æ”¯æŒåˆ†é¡µæµè§ˆ
- âœ… **å“åº”å¼è®¾è®¡** - ä½¿ç”¨ Bootstrap 5ï¼Œé€‚é…å„ç§è®¾å¤‡
- âœ… **æƒé™æ§åˆ¶** - ç”¨æˆ·åªèƒ½ç¼–è¾‘å’Œåˆ é™¤è‡ªå·±çš„æ–‡ç« 
- âœ… **æµè§ˆé‡ç»Ÿè®¡** - è‡ªåŠ¨ç»Ÿè®¡æ–‡ç« æµè§ˆé‡
- âœ… **è‰ç¨¿åŠŸèƒ½** - æ”¯æŒä¿å­˜è‰ç¨¿å’Œå‘å¸ƒæ–‡ç« 

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶**: Node.js + Express
- **æ¨¡æ¿å¼•æ“**: EJS (æœåŠ¡ç«¯æ¸²æŸ“)
- **æ•°æ®åº“**: Supabase (PostgreSQL)
- **è®¤è¯æœåŠ¡**: Supabase Auth
- **Markdown æ¸²æŸ“**: Marked
- **å‰ç«¯æ¡†æ¶**: Bootstrap 5
- **å›¾æ ‡åº“**: Bootstrap Icons

## ğŸ“ é¡¹ç›®ç»“æ„

```
ErgouSampleBlogFrame/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ supabase.js          # Supabase é…ç½®
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ authController.js    # è®¤è¯æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ postController.js    # æ–‡ç« æ§åˆ¶å™¨
â”‚   â”‚   â””â”€â”€ userController.js    # ç”¨æˆ·æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ middlewares/
â”‚   â”‚   â”œâ”€â”€ auth.js              # è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ errorHandler.js      # é”™è¯¯å¤„ç†ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ auth.js              # è®¤è¯è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ posts.js             # æ–‡ç« è·¯ç”±
â”‚   â”‚   â””â”€â”€ index.js             # é¦–é¡µè·¯ç”±
â”‚   â””â”€â”€ views/
â”‚       â”œâ”€â”€ layouts/
â”‚       â”‚   â””â”€â”€ main.ejs         # ä¸»å¸ƒå±€æ¨¡æ¿
â”‚       â”œâ”€â”€ partials/
â”‚       â”‚   â”œâ”€â”€ header.ejs       # å¤´éƒ¨ç»„ä»¶
â”‚       â”‚   â””â”€â”€ footer.ejs       # åº•éƒ¨ç»„ä»¶
â”‚       â”œâ”€â”€ index.ejs            # é¦–é¡µ
â”‚       â”œâ”€â”€ login.ejs            # ç™»å½•é¡µ
â”‚       â”œâ”€â”€ register.ejs         # æ³¨å†Œé¡µ
â”‚       â”œâ”€â”€ post-detail.ejs      # æ–‡ç« è¯¦æƒ…é¡µ
â”‚       â”œâ”€â”€ post-edit.ejs        # ç¼–è¾‘æ–‡ç« é¡µ
â”‚       â”œâ”€â”€ post-create.ejs      # åˆ›å»ºæ–‡ç« é¡µ
â”‚       â””â”€â”€ error.ejs            # é”™è¯¯é¡µ
â”œâ”€â”€ public/                      # é™æ€èµ„æºç›®å½•
â”‚   â”œâ”€â”€ css/
â”‚   â”œâ”€â”€ js/
â”‚   â””â”€â”€ images/
â”œâ”€â”€ sql/                         # æ•°æ®åº“è„šæœ¬
â”‚   â”œâ”€â”€ supabase.sql            # æ•°æ®åº“è¡¨ç»“æ„
â”‚   â”œâ”€â”€ complete_setup.sql      # å®Œæ•´è®¾ç½®è„šæœ¬ï¼ˆæ¨èï¼‰
â”‚   â”œâ”€â”€ create_user_profile_trigger.sql  # ç”¨æˆ·èµ„æ–™è§¦å‘å™¨
â”‚   â””â”€â”€ fix_user_profiles_insert.sql     # ä¿®å¤è„šæœ¬
â”œâ”€â”€ .env                        # ç¯å¢ƒå˜é‡ï¼ˆéœ€è¦åˆ›å»ºï¼‰
â”œâ”€â”€ .env.example                # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ app.js                      # åº”ç”¨å…¥å£æ–‡ä»¶
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®

```bash
git clone <your-repo-url>
cd ErgouSampleBlogFrame
```

### 2. å®‰è£…ä¾èµ–

```bash
npm install
```

### 3. é…ç½® Supabase

#### 3.1 åˆ›å»º Supabase é¡¹ç›®

1. è®¿é—® [Supabase](https://supabase.com) å¹¶åˆ›å»ºè´¦å·
2. åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®
3. ç­‰å¾…é¡¹ç›®åˆå§‹åŒ–å®Œæˆ

#### 3.2 è®¾ç½®æ•°æ®åº“

åœ¨ Supabase Dashboard çš„ SQL Editor ä¸­æ‰§è¡Œä»¥ä¸‹ SQL è„šæœ¬ï¼š

**æ¨èæ–¹å¼**ï¼šæ‰§è¡Œ `sql/complete_setup.sql`ï¼ˆåŒ…å«æ‰€æœ‰å¿…è¦çš„è¡¨ã€ç­–ç•¥å’Œè§¦å‘å™¨ï¼‰

æˆ–è€…åˆ†æ­¥æ‰§è¡Œï¼š
1. å…ˆæ‰§è¡Œ `sql/supabase.sql` åˆ›å»ºè¡¨ç»“æ„
2. å†æ‰§è¡Œ `sql/create_user_profile_trigger.sql` åˆ›å»ºè§¦å‘å™¨

#### 3.3 è·å– API å¯†é’¥

åœ¨ Supabase Dashboard çš„ Project Settings > API ä¸­è·å–ï¼š
- **Project URL**
- **anon/public key**

#### 3.4 é…ç½®è®¤è¯

åœ¨ Supabase Dashboard çš„ Authentication > Settings ä¸­ï¼š
- ç¡®ä¿ Email è®¤è¯å·²å¯ç”¨
- æ ¹æ®éœ€è¦é…ç½®é‚®ç®±ç¡®è®¤ï¼ˆå»ºè®®å¼€å‘ç¯å¢ƒå…³é—­ï¼Œç”Ÿäº§ç¯å¢ƒå¼€å¯ï¼‰

### 4. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` ä¸º `.env`ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„é…ç½®ï¼š

```env
# Supabase é…ç½®
SUPABASE_URL=your_supabase_project_url
SUPABASE_ANON_KEY=your_supabase_anon_key

# Session å¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨å¼ºéšæœºå­—ç¬¦ä¸²ï¼‰
SESSION_SECRET=your-session-secret-key-change-this

# æœåŠ¡å™¨ç«¯å£
PORT=3000

# ç¯å¢ƒ
NODE_ENV=development
```

### 5. è¿è¡Œé¡¹ç›®

**å¼€å‘æ¨¡å¼**ï¼ˆä½¿ç”¨ nodemonï¼Œè‡ªåŠ¨é‡å¯ï¼‰ï¼š

```bash
npm run dev
```

**ç”Ÿäº§æ¨¡å¼**ï¼š

```bash
npm start
```

### 6. è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:3000`

## ğŸ“– ä½¿ç”¨è¯´æ˜

### æ³¨å†Œè´¦å·

1. è®¿é—® `/auth/register` æˆ–ç‚¹å‡»å¯¼èˆªæ çš„"æ³¨å†Œ"
2. å¡«å†™ç”¨æˆ·åã€é‚®ç®±å’Œå¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰
3. ç‚¹å‡»æ³¨å†ŒæŒ‰é’®
4. å¦‚æœå¯ç”¨äº†é‚®ç®±ç¡®è®¤ï¼Œè¯·æ£€æŸ¥é‚®ç®±å¹¶ç‚¹å‡»ç¡®è®¤é“¾æ¥

### ç™»å½•

1. è®¿é—® `/auth/login` æˆ–ç‚¹å‡»å¯¼èˆªæ çš„"ç™»å½•"
2. è¾“å…¥é‚®ç®±å’Œå¯†ç 
3. ç‚¹å‡»ç™»å½•

### å‘å¸ƒæ–‡ç« 

1. ç™»å½•åï¼Œç‚¹å‡»å¯¼èˆªæ çš„"å†™æ–‡ç« "æŒ‰é’®
2. å¡«å†™æ–‡ç« æ ‡é¢˜å’Œå†…å®¹ï¼ˆæ”¯æŒ Markdown æ ¼å¼ï¼‰
3. é€‰æ‹©çŠ¶æ€ï¼šå‘å¸ƒ æˆ– è‰ç¨¿
4. ç‚¹å‡»"å‘å¸ƒæ–‡ç« "æŒ‰é’®

### Markdown è¯­æ³•ç¤ºä¾‹

```markdown
# ä¸€çº§æ ‡é¢˜
## äºŒçº§æ ‡é¢˜
### ä¸‰çº§æ ‡é¢˜

**ç²—ä½“æ–‡æœ¬**
*æ–œä½“æ–‡æœ¬*

- æ— åºåˆ—è¡¨é¡¹ 1
- æ— åºåˆ—è¡¨é¡¹ 2

1. æœ‰åºåˆ—è¡¨é¡¹ 1
2. æœ‰åºåˆ—è¡¨é¡¹ 2

`è¡Œå†…ä»£ç `

```ä»£ç å—
function hello() {
  console.log('Hello World!');
}
```

> å¼•ç”¨æ–‡æœ¬

[é“¾æ¥æ–‡æœ¬](https://example.com)
```

### ç¼–è¾‘æ–‡ç« 

1. åœ¨æ–‡ç« è¯¦æƒ…é¡µï¼Œç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®ï¼ˆä»…ä½œè€…å¯è§ï¼‰
2. ä¿®æ”¹æ–‡ç« å†…å®¹
3. ç‚¹å‡»"ä¿å­˜æ›´æ”¹"

### åˆ é™¤æ–‡ç« 

1. åœ¨æ–‡ç« è¯¦æƒ…é¡µï¼Œç‚¹å‡»"åˆ é™¤"æŒ‰é’®ï¼ˆä»…ä½œè€…å¯è§ï¼‰
2. ç¡®è®¤åˆ é™¤æ“ä½œ

## ğŸ—„ï¸ æ•°æ®åº“è¯´æ˜

### æ•°æ®è¡¨

- **user_profiles**: ç”¨æˆ·æ‰©å±•ä¿¡æ¯è¡¨
- **posts**: æ–‡ç« è¡¨
- **categories**: åˆ†ç±»è¡¨ï¼ˆé¢„ç•™ï¼Œå½“å‰æœªä½¿ç”¨ï¼‰

### Row Level Security (RLS)

é¡¹ç›®å¯ç”¨äº† Supabase çš„ RLS åŠŸèƒ½ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ï¼š
- ç”¨æˆ·å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å·²å‘å¸ƒçš„æ–‡ç« 
- ç”¨æˆ·åªèƒ½ç¼–è¾‘å’Œåˆ é™¤è‡ªå·±çš„æ–‡ç« 
- ç”¨æˆ·åªèƒ½åˆ›å»ºå’Œæ›´æ–°è‡ªå·±çš„ç”¨æˆ·èµ„æ–™

## âš™ï¸ é…ç½®è¯´æ˜

### è¯·æ±‚ä½“å¤§å°é™åˆ¶

é»˜è®¤æ”¯æŒæœ€å¤§ 50MB çš„æ–‡ç« å†…å®¹ã€‚å¦‚éœ€è°ƒæ•´ï¼Œä¿®æ”¹ `app.js` ä¸­çš„ï¼š

```javascript
app.use(express.json({ limit: '50mb' }));
app.use(express.urlencoded({ extended: true, limit: '50mb' }));
```

### åˆ†é¡µè®¾ç½®

é»˜è®¤æ¯é¡µæ˜¾ç¤º 10 ç¯‡æ–‡ç« ã€‚å¦‚éœ€è°ƒæ•´ï¼Œä¿®æ”¹ `src/controllers/postController.js` ä¸­çš„ï¼š

```javascript
const limit = 10; // ä¿®æ”¹ä¸ºä½ æƒ³è¦çš„æ•°é‡
```

## ğŸ› å¸¸è§é—®é¢˜

### 1. æ³¨å†Œæ—¶æç¤º"Database error saving new user"

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿å·²æ‰§è¡Œ `sql/complete_setup.sql` æˆ– `sql/create_user_profile_trigger.sql`
- æ£€æŸ¥ Supabase é¡¹ç›®è®¾ç½®ä¸­æ˜¯å¦å¯ç”¨äº† Email è®¤è¯

### 2. æ–‡ç« æ— æ³•æ˜¾ç¤º

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥æ–‡ç« çŠ¶æ€æ˜¯å¦ä¸º "published"
- æŸ¥çœ‹æœåŠ¡å™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
- ç¡®è®¤æ•°æ®åº“è¿æ¥æ­£å¸¸

### 3. é¡µè„šä½ç½®ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿æµè§ˆå™¨æ”¯æŒ Flexboxï¼ˆç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒï¼‰
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ååˆ·æ–°é¡µé¢

## ğŸ”’ å®‰å…¨å»ºè®®

åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰ï¼Œè¯·ç¡®ä¿ï¼š

1. **ä¿®æ”¹ Session Secret**ï¼šä½¿ç”¨å¼ºéšæœºå­—ç¬¦ä¸²
   ```bash
   # ç”Ÿæˆéšæœºå­—ç¬¦ä¸²
   node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
   ```

2. **å¯ç”¨ HTTPS**ï¼šé…ç½® SSL è¯ä¹¦

3. **é…ç½®ç¯å¢ƒå˜é‡**ï¼šä¸è¦å°† `.env` æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶

4. **è®¾ç½® Supabase RLS ç­–ç•¥**ï¼šæ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´å®‰å…¨ç­–ç•¥

5. **å¯ç”¨é‚®ç®±ç¡®è®¤**ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®å¯ç”¨é‚®ç®±éªŒè¯

## ğŸ“ å¼€å‘è¯´æ˜

è¿™æ˜¯ä¸€ä¸ªå­¦ä¹ é¡¹ç›®ï¼Œé€‚åˆï¼š
- å­¦ä¹  Node.js å’Œ Express æ¡†æ¶
- ç†è§£æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰
- å­¦ä¹  Supabase çš„ä½¿ç”¨
- ä½œä¸ºå°å‹åšå®¢é¡¹ç›®çš„åŸºç¡€æ¡†æ¶

## ğŸ“„ License

ISC

## ğŸ™ è‡´è°¢

- [Express](https://expressjs.com/)
- [Supabase](https://supabase.com/)
- [Bootstrap](https://getbootstrap.com/)
- [Marked](https://marked.js.org/)

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿æäº¤ Issue æˆ– Pull Requestã€‚

---

**Happy Blogging! ğŸ‰**

